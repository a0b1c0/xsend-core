---
import { languages, ui, defaultLang } from '../i18n/ui';
import ThemeToggle from './ThemeToggle.astro';

interface Props {
  lang: string;
}

const { lang } = Astro.props;
const t = ui[lang as keyof typeof ui] || ui[defaultLang];

const navItems = [
  { href: `/${lang}/`, label: t['nav.home'] },
  { href: `/${lang}/blog`, label: t['nav.blog'] },
  { href: `/${lang}/faq`, label: t['nav.faq'] },
];
---

<header class="sticky top-0 z-50 w-full backdrop-blur-lg border-b border-slate-200 dark:border-slate-800 bg-white/80 dark:bg-slate-950/80">
  <div class="max-w-7xl mx-auto flex items-center justify-between px-4 sm:px-6 lg:px-8 h-16">
    <a href={`/${lang}/`} class="flex items-center gap-2 font-bold text-xl text-slate-900 dark:text-white">
      {/* Logo using generated PNG */}
      <img src="/logo.png" alt="xSend Logo" class="w-8 h-8 rounded-md" />
      <span class="text-emerald-500">x</span>Send
    </a>

    <nav class="hidden md:flex gap-6">
      {navItems.map(item => (
        <a href={item.href} class="text-sm font-medium text-slate-600 hover:text-emerald-600 dark:text-slate-400 dark:hover:text-emerald-400 transition-colors">
          {item.label}
        </a>
      ))}
    </nav>

    <div class="flex items-center gap-4">

      <div class="relative group">
        <button class="flex items-center gap-1 text-sm font-medium text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white">
          <span class="uppercase">{lang}</span>
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
        </button>
        <div class="absolute right-0 top-full pt-2 w-56 hidden group-hover:block">
          <div class="bg-white dark:bg-slate-900 rounded-lg shadow-xl border border-slate-100 dark:border-slate-800 overflow-hidden">
            <div class="p-2 border-b border-slate-100 dark:border-slate-800 sticky top-0 bg-white dark:bg-slate-900 px-3">
               <input 
                  type="text" 
                  id="lang-search" 
                  placeholder="Search..." 
                  class="w-full px-2 py-1 text-sm rounded-md border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 text-slate-700 dark:text-slate-300 focus:outline-none focus:ring-2 focus:ring-emerald-500"
                  onclick="event.stopPropagation()"
               />
            </div>
            <div class="max-h-96 overflow-y-auto" id="lang-list">
              {Object.entries(languages).map(([code, label]) => (
                <a href={`/${code}/`} class="lang-item block px-4 py-2 text-sm text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-800" data-label={label.toLowerCase()} data-code={code}>
                  {label}
                </a>
              ))}
            </div>
          </div>
        </div>
        <script>
          const searchInput = document.getElementById('lang-search');
          const langList = document.getElementById('lang-list');
          if (searchInput && langList) {
            searchInput.addEventListener('input', (e) => {
              const term = (e.target as HTMLInputElement).value.toLowerCase();
              const items = langList.querySelectorAll('.lang-item');
              items.forEach((item) => {
                 const label = item.getAttribute('data-label') || '';
                 const code = item.getAttribute('data-code') || '';
                 if (label.includes(term) || code.includes(term)) {
                    (item as HTMLElement).style.display = 'block';
                 } else {
                    (item as HTMLElement).style.display = 'none';
                 }
              });
            });
          }
        </script>
      </div>
      <ThemeToggle />
      <a href={`/${lang}/#download`} class="hidden">
      
      </a>
    </div>
  </div>
</header>
