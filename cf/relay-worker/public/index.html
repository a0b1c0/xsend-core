<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>xsend relay</title>
    <style>
      :root {
        --bg: #0b0f19;
        --panel: rgba(17, 24, 42, 0.85);
        --text: #e7ecf5;
        --muted: rgba(231, 236, 245, 0.65);
        --line: rgba(231, 236, 245, 0.12);
        --accent: #59f3a6;
        --bad: #ff5c7a;
        --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",
          "Courier New", monospace;
        --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      }

      html,
      body {
        height: 100%;
        margin: 0;
        background: radial-gradient(1200px 600px at 20% -10%, rgba(89, 243, 166, 0.22), transparent),
          radial-gradient(1000px 700px at 100% 0%, rgba(92, 130, 255, 0.2), transparent),
          var(--bg);
        color: var(--text);
        font-family: var(--sans);
      }

      .wrap {
        max-width: 980px;
        margin: 36px auto;
        padding: 0 16px;
      }

      h1 {
        margin: 0 0 6px 0;
        font-size: 22px;
        letter-spacing: 0.2px;
      }

      .muted {
        color: var(--muted);
        font-size: 12px;
        line-height: 1.45;
      }

      .card {
        margin-top: 14px;
        border: 1px solid var(--line);
        border-radius: 12px;
        background: var(--panel);
        box-shadow: 0 18px 50px rgba(0, 0, 0, 0.35);
        overflow: hidden;
      }

      .card .head {
        padding: 12px 14px;
        border-bottom: 1px solid var(--line);
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 12px;
        flex-wrap: wrap;
      }

      .card .head h2 {
        margin: 0;
        font-size: 13px;
        text-transform: uppercase;
        letter-spacing: 0.7px;
        color: var(--muted);
      }

      .card .body {
        padding: 14px;
      }

      .row {
        display: grid;
        grid-template-columns: 1fr;
        gap: 10px;
      }

      @media (min-width: 720px) {
        .row.two {
          grid-template-columns: 1fr 1fr;
        }
      }

      label {
        display: block;
        font-size: 12px;
        color: var(--muted);
        margin-bottom: 8px;
      }

      input[type="text"],
      input[type="password"],
      textarea {
        width: 100%;
        box-sizing: border-box;
        border-radius: 10px;
        border: 1px solid rgba(231, 236, 245, 0.16);
        background: rgba(7, 10, 18, 0.75);
        color: var(--text);
        padding: 10px 12px;
        font-family: var(--mono);
        outline: none;
      }

      textarea {
        min-height: 120px;
        resize: vertical;
      }

      button {
        cursor: pointer;
        border-radius: 10px;
        border: 1px solid rgba(231, 236, 245, 0.16);
        background: rgba(7, 10, 18, 0.55);
        color: var(--text);
        padding: 10px 12px;
        font-family: var(--sans);
        font-weight: 700;
      }

      button.primary {
        border-color: rgba(89, 243, 166, 0.45);
        background: rgba(89, 243, 166, 0.12);
      }

      button.danger {
        border-color: rgba(255, 92, 122, 0.5);
        background: rgba(255, 92, 122, 0.12);
      }

      .err {
        color: var(--bad);
        font-family: var(--mono);
        font-size: 12px;
        white-space: pre-wrap;
      }

      .kv {
        display: grid;
        grid-template-columns: 140px 1fr;
        gap: 6px 10px;
        font-family: var(--mono);
        font-size: 12px;
      }

      .kv .k {
        color: var(--muted);
      }

      .files {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .file {
        border: 1px solid var(--line);
        border-radius: 12px;
        padding: 12px;
        background: rgba(7, 10, 18, 0.25);
      }

      .file .topline {
        display: flex;
        justify-content: space-between;
        gap: 10px;
        flex-wrap: wrap;
      }

      .file .name {
        font-family: var(--mono);
        font-size: 12px;
        word-break: break-all;
      }

      .file .meta {
        font-family: var(--mono);
        font-size: 12px;
        color: var(--muted);
      }

      .mode-switch {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .peer-grid {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .peer {
        border: 1px solid var(--line);
        border-radius: 12px;
        padding: 10px;
        background: rgba(7, 10, 18, 0.25);
        display: grid;
        gap: 8px;
      }

      .peer.active {
        border-color: rgba(89, 243, 166, 0.55);
      }

      .badge {
        display: inline-block;
        font-size: 11px;
        font-family: var(--mono);
        color: var(--muted);
      }

      .hidden {
        display: none !important;
      }

      .mini {
        font-size: 11px;
        color: var(--muted);
      }

      .codebox {
        min-height: 160px;
      }

      .qr-wrap {
        min-height: 220px;
        border: 1px dashed var(--line);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 8px;
      }

      .qr-wrap img,
      .qr-wrap canvas,
      .qr-wrap svg {
        width: min(80vw, 360px);
        height: auto;
        max-width: 360px;
        max-height: 360px;
      }

      #rtScanWrap {
        border: 1px solid var(--line);
        border-radius: 12px;
        padding: 10px;
        background: rgba(7, 10, 18, 0.35);
      }

      #rtScanVideo {
        width: 100%;
        max-height: 240px;
        border-radius: 10px;
        background: #000;
      }

      a {
        color: rgba(89, 243, 166, 0.95);
        text-decoration: none;
      }

      a:hover {
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <h1>xsend relay</h1>
      <div class="muted">
        Free tier: up to 5 files, each <= 10MiB, total <= 50MiB. Stored for 7 days. Any file type is allowed.
      </div>

      <div class="card">
        <div class="head">
          <h2>Quick Link (No Login)</h2>
          <div class="muted" id="rtModeBadge">Auto-Discovery</div>
        </div>
        <div class="body">
          <div class="err" id="rtErr"></div>
          <div class="muted">
            Same WiFi: open this page on both devices and it will auto-discover. Offline mode uses local offer/answer code with optional QR scan, fingerprint verification, and shard-aware QR stitching.
          </div>
          <div style="height: 10px"></div>
          <div class="mode-switch">
            <button id="rtModeAuto" class="primary">Auto-Discovery</button>
            <button id="rtModeOffline">Offline Mode</button>
          </div>

          <div style="height: 12px"></div>
          <div class="row two">
            <div>
              <label for="rtDeviceName">Device name</label>
              <input id="rtDeviceName" type="text" placeholder="My phone" />
            </div>
            <div>
              <label for="rtScope">Scope (optional, to isolate room)</label>
              <input id="rtScope" type="text" placeholder="home-1" />
            </div>
          </div>
          <div style="height: 10px"></div>
          <div class="mini">
            status: <span id="rtStatus">idle</span> |
            me: <span id="rtSelfId">-</span> |
            selected peer: <span id="rtSelectedPeer">-</span>
          </div>

          <div id="rtAutoPanel">
            <div style="height: 12px"></div>
            <div style="display: flex; gap: 10px; flex-wrap: wrap">
              <button id="rtStartAuto" class="primary">Start</button>
              <button id="rtStopAuto" class="danger">Stop</button>
              <button id="rtRefreshPeers">Refresh peers</button>
              <button id="rtConnectPeer" class="primary">Connect selected</button>
              <button id="rtDisconnectPeer" class="danger">Disconnect selected</button>
            </div>

            <div style="height: 12px"></div>
            <div class="muted">Peers in same room</div>
            <div style="height: 8px"></div>
            <div class="peer-grid" id="rtPeers"></div>

            <div style="height: 12px"></div>
            <div>
              <label for="rtAutoFiles">Send file to selected peer</label>
              <input id="rtAutoFiles" type="file" multiple />
            </div>
            <div style="height: 8px"></div>
            <div style="display: flex; gap: 10px; flex-wrap: wrap">
              <button id="rtSendAuto" class="primary">Send</button>
            </div>
            <div style="height: 8px"></div>
            <div class="mini" id="rtTransferStatus">no transfer</div>
          </div>

          <div id="rtOfflinePanel" class="hidden">
            <div style="height: 12px"></div>
            <div class="row two">
              <div>
                <label for="rtOfferCodeOut">1) Create offer (Sender)</label>
                <textarea id="rtOfferCodeOut" class="codebox" readonly></textarea>
                <div style="height: 8px"></div>
                <div class="qr-wrap" id="rtOfferQr"></div>
                <div style="height: 8px"></div>
                <button id="rtCreateOffer" class="primary">Create offer code</button>
              </div>
              <div>
                <label for="rtOfferCodeIn">2) Receiver paste/scan offer then create answer</label>
                <textarea id="rtOfferCodeIn" class="codebox" placeholder="Paste offer code here"></textarea>
                <div style="height: 8px"></div>
                <div style="display: flex; gap: 10px; flex-wrap: wrap">
                  <button id="rtScanOffer">Scan QR to offer</button>
                  <button id="rtCreateAnswer" class="primary">Create answer code</button>
                </div>
              </div>
            </div>

            <div style="height: 12px"></div>
            <div class="row two">
              <div>
                <label for="rtAnswerCodeOut">3) Share answer to sender</label>
                <textarea id="rtAnswerCodeOut" class="codebox" readonly></textarea>
                <div style="height: 8px"></div>
                <div class="qr-wrap" id="rtAnswerQr"></div>
              </div>
              <div>
                <label for="rtAnswerCodeIn">4) Sender paste/scan answer and finish handshake</label>
                <textarea id="rtAnswerCodeIn" class="codebox" placeholder="Paste answer code here"></textarea>
                <div style="height: 8px"></div>
                <div style="display: flex; gap: 10px; flex-wrap: wrap">
                  <button id="rtScanAnswer">Scan QR to answer</button>
                  <button id="rtApplyAnswer" class="primary">Apply answer</button>
                  <button id="rtVerifyOfflineFp">Verify fingerprint</button>
                  <button id="rtResetOffline" class="danger">Reset offline session</button>
                </div>
                <div style="height: 8px"></div>
                <div class="mini" id="rtOfflineFp">fingerprint: -</div>
              </div>
            </div>

            <div style="height: 12px"></div>
            <div>
              <label for="rtOfflineFiles">Send file (offline channel)</label>
              <input id="rtOfflineFiles" type="file" multiple />
            </div>
            <div style="height: 8px"></div>
            <button id="rtSendOffline" class="primary">Send offline</button>

            <div style="height: 12px"></div>
            <div id="rtScanWrap" class="hidden">
              <div class="mini">Scanning QR...</div>
              <div style="height: 8px"></div>
              <video id="rtScanVideo" playsinline muted></video>
              <div style="height: 8px"></div>
              <button id="rtStopScan" class="danger">Stop scan</button>
            </div>
          </div>

          <div style="height: 12px"></div>
          <div class="muted">Received files</div>
          <div style="height: 8px"></div>
          <div class="files" id="rtReceivedList"></div>
        </div>
      </div>

      <div class="card">
        <div class="head">
          <h2>Account</h2>
          <div class="muted" id="acctStatus">signed out</div>
        </div>
        <div class="body">
          <div class="err" id="err"></div>

          <div style="height: 12px"></div>
          <div class="row two">
            <div>
              <label for="identifier">Username or email</label>
              <input id="identifier" type="text" placeholder="you@example.com" />
            </div>
            <div>
              <label for="password">Password</label>
              <input id="password" type="password" placeholder="********" />
            </div>
          </div>

          <div style="height: 10px"></div>
          <div style="display: flex; gap: 10px; flex-wrap: wrap">
            <button id="login" class="primary">Sign in</button>
            <button id="register">Create account</button>
            <button id="logout" class="danger">Sign out</button>
          </div>

          <div style="height: 14px"></div>
          <div class="muted">Or continue with</div>
          <div style="height: 10px"></div>
          <div style="display: flex; gap: 10px; flex-wrap: wrap">
            <button id="oauthGoogle" class="primary">Google</button>
            <button id="oauthGitHub" class="primary">GitHub</button>
            <button id="oauthApple" class="primary">Apple</button>
          </div>
          <div style="height: 10px"></div>
          <div class="muted" id="oauthHint">-</div>

          <div style="height: 10px"></div>
          <div class="muted">
            Note: this relay is for logged-in users. When signed in, you don't need to enter any code.
          </div>
        </div>
      </div>

      <div class="card">
        <div class="head">
          <h2>My Relay</h2>
          <div class="muted" id="myCode">-</div>
        </div>
        <div class="body">
          <div class="kv">
            <div class="k">status</div>
            <div id="status">-</div>
            <div class="k">expires</div>
            <div id="expires">-</div>
            <div class="k">plan</div>
            <div id="plan">-</div>
            <div class="k">today usage</div>
            <div id="usageToday">-</div>
            <div class="k">month usage</div>
            <div id="usageMonth">-</div>
            <div class="k">estimated</div>
            <div id="billingEst">-</div>
            <div class="k">subscription</div>
            <div id="billingSub">-</div>
            <div class="k">limits</div>
            <div id="limits">-</div>
          </div>

          <div style="height: 12px"></div>
          <div>
            <label for="files">Upload (<= 10MiB each)</label>
            <input id="files" type="file" multiple />
          </div>
          <div style="height: 10px"></div>
          <div style="display: flex; gap: 10px; flex-wrap: wrap">
            <button id="upload" class="primary">Upload</button>
            <button id="refresh">Refresh</button>
            <button id="billingCheckout">Upgrade to Pro</button>
            <button id="billingPortal">Billing Portal</button>
            <button id="billingCancel">Cancel at Period End</button>
            <button id="billingResume">Resume Subscription</button>
            <button id="billingReportCsv">Export Monthly CSV</button>
          </div>
          <div style="height: 10px"></div>
          <div class="muted" id="uploadHint">-</div>
          <div style="height: 8px"></div>
          <div class="muted" id="billingHint">-</div>
        </div>
      </div>

      <div class="card">
        <div class="head">
          <h2>Files</h2>
          <div class="muted" id="count">0</div>
        </div>
        <div class="body">
          <div class="files" id="fileList"></div>
        </div>
      </div>

      <div class="card">
        <div class="head">
          <h2>Invoices</h2>
          <div class="muted" id="invoiceCount">0</div>
        </div>
        <div class="body">
          <div class="files" id="invoiceList"></div>
        </div>
      </div>

      <div class="card">
        <div class="head">
          <h2>Refunds</h2>
          <div class="muted" id="refundCount">0</div>
        </div>
        <div class="body">
          <div class="files" id="refundList"></div>
        </div>
      </div>

      <div class="card">
        <div class="head">
          <h2>Disputes</h2>
          <div class="muted" id="disputeCount">0</div>
        </div>
        <div class="body">
          <div class="files" id="disputeList"></div>
        </div>
      </div>
    </div>

    <script src="/vendor/fast_qr_nomod/fast_qr.js"></script>
    <script src="/vendor/pako/pako.min.js"></script>
    <script src="/realtime.js"></script>
    <script src="/app.js"></script>
  </body>
</html>
